from ai import chain_prompt
import json
from ai import data_ 
moscow_metro_stations = [
    # Сокольническая линия (красная)
    "Бульвар Рокоссовского", "Черкизовская", "Преображенская площадь", "Сокольники",
    "Красносельская", "Комсомольская", "Красные Ворота", "Чистые пруды",
    "Лубянка", "Охотный Ряд", "Библиотека имени Ленина", "Кропоткинская",
    "Парк культуры", "Фрунзенская", "Спортивная", "Воробьёвы горы",
    "Университет", "Проспект Вернадского", "Юго-Западная", "Тропарёво",
    "Румянцево", "Саларьево", "Филатов Луг", "Прокшино", "Ольховая",
    
    # Замоскворецкая линия (зелёная)
    "Ховрино", "Беломорская", "Речной вокзал", "Водный стадион",
    "Войковская", "Сокол", "Аэропорт", "Динамо",
    "Белорусская", "Маяковская", "Тверская", "Театральная",
    "Новокузнецкая", "Павелецкая", "Автозаводская", "Коломенская",
    "Каширская", "Кантемировская", "Царицыно", "Орехово",
    "Домодедовская", "Красногвардейская", "Алма-Атинская",
    
    # Арбатско-Покровская линия (синяя)
    "Щёлковская", "Первомайская", "Измайловская", "Партизанская",
    "Семёновская", "Электрозаводская", "Бауманская", "Курская",
    "Площадь Революции", "Арбатская", "Смоленская", "Киевская",
    "Парк Победы", "Славянский бульвар", "Кунцевская", "Молодёжная",
    "Крылатское", "Строгино", "Мякинино", "Волоколамская",
    "Митино", "Пятницкое шоссе",
    
    # Филевская линия (голубая)
    "Кунцевская", "Пионерская", "Филёвский парк", "Багратионовская",
    "Фили", "Кутузовская", "Студенческая", "Международная",
    "Выставочная", "Киевская", "Смоленская", "Арбатская",
    
    # Кольцевая линия (коричневая)
    "Парк культуры", "Октябрьская", "Добрынинская", "Павелецкая",
    "Таганская", "Курская", "Комсомольская", "Проспект Мира",
    "Новослободская", "Белорусская", "Краснопресненская", "Киевская",
    
    # Калужско-Рижская линия (оранжевая)
    "Медведково", "Бабушкинская", "Свиблово", "Ботанический сад",
    "ВДНХ", "Алексеевская", "Рижская", "Проспект Мира",
    "Сухаревская", "Тургеневская", "Китай-город", "Третьяковская",
    "Октябрьская", "Шаболовская", "Ленинский проспект", "Академическая",
    "Профсоюзная", "Новые Черёмушки", "Калужская", "Беляево",
    "Коньково", "Тёплый Стан", "Ясенево", "Новоясеневская",
    
    # Таганско-Краснопресненская линия (фиолетовая)
    "Котельники", "Жулебино", "Лермонтовский проспект", "Выхино",
    "Рязанский проспект", "Кузьминки", "Текстильщики", "Волгоградский проспект",
    "Пролетарская", "Таганская", "Китай-город", "Кузнецкий мост",
    "Пушкинская", "Баррикадная", "Улица 1905 года", "Беговая",
    "Полежаевская", "Октябрьское Поле", "Щукинская", "Спартак",
    "Тушинская", "Сходненская", "Планерная",
    
    # Калининская линия (желтая)
    "Новокосино", "Новогиреево", "Перово", "Шоссе Энтузиастов",
    "Авиамоторная", "Площадь Ильича", "Марксистская", "Третьяковская",
    
    # Серпуховско-Тимирязевская линия (серая)
    "Алтуфьево", "Бибирево", "Отрадное", "Владыкино",
    "Петровско-Разумовская", "Тимирязевская", "Дмитровская", "Савёловская",
    "Менделеевская", "Цветной бульвар", "Чеховская", "Боровицкая",
    "Полянка", "Серпуховская", "Тульская", "Нагатинская",
    "Нагорная", "Нахимовский проспект", "Севастопольская", "Чертановская",
    "Южная", "Пражская", "Улица Академика Янгеля", "Аннино",
    "Бульвар Дмитрия Донского",
    
    # Люблинско-Дмитровская линия (салатовая)
    "Физтех", "Лианозово", "Яхромская", "Селигерская",
    "Верхние Лихоборы", "Окружная", "Петровско-Разумовская", "Фонвизинская",
    "Бутырская", "Марьина Роща", "Достоевская", "Трубная",
    "Сретенский бульвар", "Чкаловская", "Римская", "Крестьянская застава",
    "Дубровка", "Кожуховская", "Печатники", "Волжская",
    "Люблино", "Братиславская", "Марьино", "Борисово",
    "Шипиловская", "Зябликово",
    
    # Бутовская линия (серая)
    "Битцевский парк", "Лесопарковая", "Улица Старокачаловская", "Улица Скобелевская",
    "Бульвар Адмирала Ушакова", "Улица Горчакова", "Бунинская аллея",
    
    # Некрасовская линия (розовая)
    "Некрасовка", "Лухмановская", "Улица Дмитриевского", "Косино",
    "Юго-Восточная", "Окская", "Стахановская", "Нижегородская",
    "Авиамоторная", "Лефортово", "Электрозаводская",
    
    # Большая кольцевая линия (толстое кольцо)
    "Нижегородская", "Авиамоторная", "Лефортово", "Электрозаводская",
    "Сокольники", "Рижская", "Марьина Роща", "Савеловская",
    "Петровский парк", "ЦСКА", "Хорошёвская", "Шелепиха",
    "Деловой центр", "Народное ополчение", "Мнёвники", "Терехово",
    "Кунцевская", "Давыдково", "Аминьевская", "Мичуринский проспект",
    "Проспект Вернадского", "Новаторская", "Воронцовская", "Зюзино",
    "Каховская"
]

JSON_FILE = "tg_posts.json"
import traceback
def load_old(JSON_FILE=JSON_FILE):
    while True:
        try:

            with open(JSON_FILE, 'r', encoding='utf-8') as file:
                return json.load(file)
        except:
            pass
error_counter = 0
exception_counter = 0
old = load_old()
global dt
dt = data_

for channel in list(old.keys()):
    for post in old[channel][-100:]:
        addon, good_description = chain_prompt(data=dt, desc=post["text"], type = 1,telegram=True)
        
        dt = {
            'model': 'gpt-4o-mini', 
            'messages': [ {'role': 'user', 'content': r"{0} {1}"}
            ]}
        
        try:
            if addon != '':
            
                if addon[0]['станция метро'] not in moscow_metro_stations:
                    error_counter += 1
        except:
            exception_counter += 1
            print(traceback.format_exc())
            import pdb; pdb.set_trace()
print(error_counter)
print(exception_counter)
#addon, good_description = chain_prompt(data=dt, desc=filtered_post["text"], type = 1,telegram=True)